<html><head><title>service worker loader</title><style>body{background:red}</style></head><body> <script type="module">var e;e=new URL("service-worker.js",import.meta.url).toString(),async function(){const o=window.location.href,r=o.split("/service-worker-loader.html")[0].split("background-scripts/")[1],t=document.createElement("div");t.innerHTML=o;document.getElementsByTagName("body")[0].appendChild(t),console.log("currentUrlHash",r);const s=await navigator.serviceWorker.getRegistrations();console.log("# SERVICE WORKERS",s.length);for(let e of s){console.log("SERVICE WORKER: exists",e.scope);try{const o=e.scope.split("background-scripts/")[1].split("/")[0];console.log("hash",o),r!==o&&(console.log("SERVICE WORKER: unregistering",e),await e.unregister())}catch(e){console.error("SERVICE WORKER error unregistering",e)}}try{const o=await navigator.serviceWorker.register(e);o.update(),document.querySelector("body").style.background="yellow",console.log("SERVICE WORKER: registered",o)}catch(e){console.log("SERVICE WORKER: registration failed",e)}navigator.serviceWorker.addEventListener("install",(e=>{console.log("SERVICE WORKER: installing",e),document.querySelector("body").style.background="orange"})),navigator.serviceWorker.addEventListener("activate",(e=>{console.log("SERVICE WORKER: activating",e),document.querySelector("body").style.background="blue"})),navigator.serviceWorker.onmessage=e=>{console.log("SERVICE WORKER: message received",e),document.querySelector("body").style.background="green",window.ReactNativeWebView?.postMessage(JSON.stringify(e.data))},window.postMessageToBackgroundViaWebview=e=>{console.log("SERVICE WORKER: message sent",e),navigator.serviceWorker.controller.postMessage(e)}}();</script> </body></html>