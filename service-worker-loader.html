<html><head><title>service worker loader</title><style>body{background:red}</style></head><body> <script type="module">var e;e=new URL("service-worker.js",import.meta.url).toString(),async function(){const o=window.location.href,t=o.split("/service-worker-loader.html")[0].split("background-scripts/")[1],r=document.createElement("div");r.innerHTML=o;document.getElementsByTagName("body")[0].appendChild(r),console.log("currentUrlHash",t);const a=await navigator.serviceWorker.getRegistrations();console.log("# SERVICE WORKERS",a.length);try{const o=await navigator.serviceWorker.register(e);o.update(),document.querySelector("body").style.background="yellow",console.log("SERVICE WORKER: registered",o);const t=await o.waiting||o.active;await(t?.postMessage?.({type:"READY"}))}catch(e){console.log("SERVICE WORKER: registration failed",e)}navigator.serviceWorker.addEventListener("install",(e=>{console.log("SERVICE WORKER: installing",e),document.querySelector("body").style.background="orange"})),navigator.serviceWorker.addEventListener("activate",(e=>{console.log("SERVICE WORKER: activating",e),document.querySelector("body").style.background="blue"})),navigator.serviceWorker.onmessage=e=>{console.log("SERVICE WORKER: message received",e),document.querySelector("body").style.background="green",window.ReactNativeWebView?.postMessage(JSON.stringify(e.data))},window.postMessageToBackgroundViaWebview=e=>{console.log("SERVICE WORKER: message sent",e),navigator.serviceWorker.controller.postMessage(e)}}();</script> </body></html>